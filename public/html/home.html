<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/e1a2c43e41.js" crossorigin="anonymous"></script>

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts Link For Icons -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
    <script src="script.js" defer></script>
    <link rel="icon" href="/images/5572662.png" type="/images/5572662.png">

    <title>ON-MARKET</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "FIREBASE_API_KEY",
            authDomain: "FIREBASE_AUTH_DOMAIN",
            projectId: "FIREBASE_PROJECT_ID",
            storageBucket: "FIREBASE_STORAGE_BUCKET",
            messagingSenderId: "FIREBASE_MESSAGING_SENDER_ID",
            appId: "FIREBASE_APP_ID"
        };

        firebase.initializeApp(firebaseConfig) 
    </script>

    <script>
        function formatNumberToKoreanStyle(number) {
            return number.toLocaleString('ko-KR');
        }


        let viewCount = 0;

        function incrementViewCount() {
            viewCount++;
            document.getElementById('countDisplay').innerText = viewCount;
        }

        const db = firebase.firestore();


        //ë°©ê¸ˆ ë“±ë¡í•œ ìƒí’ˆ
        $(document).ready(function () {
            const itemsPerPage = 4;
            let displayedItems = 0;

            function fetchProducts() {
                db.collection('product').orderBy('ë‚ ì§œ', 'desc').limit(displayedItems + itemsPerPage).get()
                    .then((snapshot) => {
                        let currentCount = 0;

                        snapshot.forEach((doc) => {
                            if (currentCount < displayedItems) {
                                currentCount++;
                                return;
                            }

                            let formattedPrice = Number(doc.data().ê°€ê²©).toLocaleString();
                            let priceInfo = doc.data().ë¬´ë£Œë‚˜ëˆ” ? 'ë¬´ë£Œ ë‚˜ëˆ”' : `${formattedPrice}ì›`;

                            var í…œí”Œë¦¿ = `
                        <div class="item">
                            <a href="/detail.html?id=${doc.id}" class="item_link" data-id="${doc.id}">
                                <img class="item_image" src="${doc.data().ì´ë¯¸ì§€1}" style="border-radius: 12px;">
                                <h2 class="item_name">${doc.data().ì œëª©}</h2>
                                <h2 class="item_cost">${priceInfo}</h2>
                                <h1 class="item_place">${doc.data().ì£¼ì†Œ}</h1>
                                <div class="like_chating">
                                    <span class="like">ì¡°íšŒìˆ˜ ${doc.data().ì¡°íšŒìˆ˜}</span>
                                    <span>&nbsp;&nbsp;ãƒ»&nbsp;&nbsp;</span>
                                    <span class="chat">ì±„íŒ… ${doc.data().ì±„íŒ…ë°ì´í„°}</span>
                                    <span>&nbsp;&nbsp;ãƒ»&nbsp;&nbsp;</span>
                                    <span class="chat">ê´€ì‹¬ ${doc.data().ê´€ì‹¬}</span>
                                </div>
                            </a>
                        </div>`;

                            $('.item_box_1').append(í…œí”Œë¦¿); // ìƒí’ˆ ì¶”ê°€
                            currentCount++;
                        });

                        displayedItems += currentCount;
                        arrangeGrid();

                        // ìƒˆë¡œ ì¶”ê°€ëœ ì•„ì´í…œì— ì§ì ‘ CSSë¥¼ ì„¤ì •í•˜ì—¬ ë„ˆë¹„ë¥¼ ê³ ì •
                        $('.item_box_1 .item').slice(displayedItems - currentCount).css('width', 'calc(25% - 20px)');
                    })
                    .catch((error) => {
                        console.log("Error getting documents: ", error);
                    });
            }

            fetchProducts();

            $('.more_item_btn1').on('click', function () {
                fetchProducts();
            });

            function arrangeGrid() {
                const rowCount = Math.ceil(displayedItems / 4);
                $('.item_box_1').css('grid-template-rows', `repeat(${rowCount}, auto)`);

                if (displayedItems >= 4) {
                    $('.item_box_1 .item').css('display', 'block');
                    $('.item_box_1 .item').css('float', 'left');
                }
            }
        });



        //ì‹¤ì‹œê°„ ì¸ê¸°ìƒí’ˆ ì •ë ¬

        $(document).ready(function () {
            const itemsPerPage = 4;
            let displayedItems = 0;

            function fetchProducts() {
                db.collection('product').orderBy('ì¡°íšŒìˆ˜', 'desc').limit(displayedItems + itemsPerPage).get()
                    .then((snapshot) => {
                        let currentCount = 0;

                        snapshot.forEach((doc) => {
                            if (currentCount < displayedItems) {
                                currentCount++;
                                return;
                            }

                            let formattedPrice = Number(doc.data().ê°€ê²©).toLocaleString();
                            let priceInfo = doc.data().ë¬´ë£Œë‚˜ëˆ” ? 'ë¬´ë£Œ ë‚˜ëˆ”' : `${formattedPrice}ì›`;

                            var í…œí”Œë¦¿ = `
                                <div class="item">
                                    <a href="/detail.html?id=${doc.id}" class="item_link" data-id="${doc.id}">
                                        <img class="item_image" src="${doc.data().ì´ë¯¸ì§€1}" style="border-radius: 12px;">
                                        <h2 class="item_name">${doc.data().ì œëª©}</h2>
                                        <h2 class="item_cost">${priceInfo}</h2>
                                        <h1 class="item_place">${doc.data().ì£¼ì†Œ}</h1>
                                        <div class="like_chating">
                                            <span class="like">ì¡°íšŒìˆ˜ ${doc.data().ì¡°íšŒìˆ˜}</span>
                                            <span>&nbsp;&nbsp;ãƒ»&nbsp;&nbsp;</span>
                                            <span class="chat">ì±„íŒ… ${doc.data().ì±„íŒ…ë°ì´í„°}</span>
                                            <span>&nbsp;&nbsp;ãƒ»&nbsp;&nbsp;</span>
                                            <span class="chat">ê´€ì‹¬ ${doc.data().ê´€ì‹¬}</span>
                                        </div>
                                    </a>
                                </div>`;

                            $('.item_box_2').append(í…œí”Œë¦¿); // ìƒí’ˆ ì¶”ê°€
                            currentCount++;
                        });

                        displayedItems += currentCount;
                        arrangeGrid();

                        // ìƒˆë¡œ ì¶”ê°€ëœ ì•„ì´í…œì— ì§ì ‘ CSSë¥¼ ì„¤ì •í•˜ì—¬ ë„ˆë¹„ë¥¼ ê³ ì •
                        $('.item_box_2 .item').slice(displayedItems - currentCount).css('width', 'calc(25% - 20px)');
                    })
                    .catch((error) => {
                        console.log("Error getting documents: ", error);
                    });
            }

            fetchProducts();

            $('.more_item_btn2').on('click', function () {
                fetchProducts();
            });

            function arrangeGrid() {
                const rowCount = Math.ceil(displayedItems / 4);
                $('.item_box_2').css('grid-template-rows', `repeat(${rowCount}, auto)`);

                if (displayedItems >= 4) {
                    $('.item').css('display', 'block');
                    $('.item').css('float', 'left');
                }
            }
        });

        $(document).on('click', '.item_link', function (event) {
            event.preventDefault(); // ê¸°ë³¸ ì´ë²¤íŠ¸ ë°©ì§€
            window.location.href = $(this).attr('href');
            const itemId = $(this).data('id'); // í´ë¦­í•œ ì•„ì´í…œì˜ ID ê°€ì ¸ì˜¤ê¸°

            // í•´ë‹¹ ì•„ì´í…œì˜ ì¡°íšŒìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ê¸° ìœ„í•´ Firestoreì—ì„œ í•´ë‹¹ ì•„ì´í…œ ë„íë¨¼íŠ¸ ê°€ì ¸ì˜¤ê¸°
            const productRef = db.collection('product').doc(itemId);

            // Firestoreì—ì„œ ì•„ì´í…œ ë„íë¨¼íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ì¡°íšŒìˆ˜ í•„ë“œë¥¼ ì¦ê°€ì‹œí‚¤ê¸°
            productRef.get().then((doc) => {
                if (doc.exists) {
                    // í˜„ì¬ ì¡°íšŒìˆ˜ ê°€ì ¸ì˜¤ê¸°
                    let viewCount = (doc.data().ì¡°íšŒìˆ˜ || 0) + 1;

                    // ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸
                    productRef.update({ ì¡°íšŒìˆ˜: viewCount }).then(() => {
                        console.log("View count updated successfully!");
                    }).catch((error) => {
                        console.error("Error updating view count:", error);
                    });
                } else {
                    console.log(`Document with ID ${itemId} does not exist!`);
                }
            }).catch((error) => {
                console.error("Error getting document:", error);
            });
        });



        // ì•„ì´í…œ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
        $('.item_link').on('click', function (event) {

            // í´ë¦­í•œ ì•„ì´í…œì˜ ë„íë¨¼íŠ¸ ID ê°€ì ¸ì˜¤ê¸°
            let itemId = $(this).data('id');

            console.log("Clicked Item ID:", itemId); // í´ë¦­í•œ ì•„ì´í…œì˜ ID ì¶œë ¥
            if (itemId === undefined) {
                console.log("data-id is undefined!");
                return;
            }

            updateViewCount(itemId);  // ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ í˜¸ì¶œ
        });


        function updateViewCount(itemId) {
            const productRef = db.collection('product').doc(itemId);

            // Firestore íŠ¸ëœì­ì…˜ ì‚¬ìš©í•˜ì—¬ viewCount ì—…ë°ì´íŠ¸
            db.runTransaction((transaction) => {
                return transaction.get(productRef).then((doc) => {
                    if (!doc.exists) {
                        throw new Error(`Document with ID ${itemId} does not exist!`);
                    }

                    // í˜„ì¬ ì¡°íšŒìˆ˜ ê°€ì ¸ì˜¤ê¸°
                    let viewCount = (doc.data().ì¡°íšŒìˆ˜ || 0) + 1;

                    // ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸
                    transaction.update(productRef, { ì¡°íšŒìˆ˜: viewCount });
                });
            }).then(() => {
                console.log("View count updated successfully!");
            }).catch((error) => {
                console.log("Transaction failed: ", error.message);
            });
        }
    </script>

    <!-- ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì—…ë¡œë“œ ë²„íŠ¼ í™œì„±í™” ë˜ëŠ” ë¹„í™œì„±í™”í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€ -->
    <script>
        // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ” ê²½ìš°
                // ì—…ë¡œë“œ ë²„íŠ¼ í™œì„±í™”
                document.querySelector('.sell_button').removeAttribute('disabled');
            } else {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°
                // ì—…ë¡œë“œ ë²„íŠ¼ ë¹„í™œì„±í™”
                document.querySelector('.sell_button').setAttribute('disabled', 'disabled');
            }
        });
    </script>

    <script>
        // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ” ê²½ìš°
                // ì´ë©”ì¼ ì£¼ì†Œë¥¼ ê°€ì ¸ì™€ì„œ í‘œì‹œ
                var userEmail = user.email;
                document.getElementById('userStatus').innerText = 'ë¡œê·¸ì¸ ì¤‘: ' + userEmail;
            } else {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°
                // ë¡œê·¸ì¸ ìƒíƒœë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                document.getElementById('userStatus').innerText = '';
            }
        });
    </script>

    <script>
        // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ ì‚¬ìš©ìì˜ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ” ê²½ìš°
                // ì´ë©”ì¼ ì£¼ì†Œë¥¼ ê°€ì ¸ì™€ì„œ í‘œì‹œ
                var userEmail = user.email;
                document.getElementById('userStatus').innerText = 'ë¡œê·¸ì¸ ì¤‘: ' + userEmail;
            } else {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°
                // ë¡œê·¸ì¸ ìƒíƒœë¥¼ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                document.getElementById('userStatus').innerText = '';
            }
        });

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜ ì •ì˜
        function logout() {
            firebase.auth().signOut().then(function () {
                // ë¡œê·¸ì•„ì›ƒ ì„±ê³µ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                location.reload();
            }).catch(function (error) {
                // ë¡œê·¸ì•„ì›ƒ ì¤‘ ì—ëŸ¬ ë°œìƒ ì‹œ ì½˜ì†”ì— ì¶œë ¥
                console.log(error.message);
            });
        }
    </script>

    <script>
        //ì¼ë°˜ ê³„ì • ë¡œê·¸ì¸
        firebase.auth().onAuthStateChanged(function (user) {
            const userInfo = document.getElementById('userInfo');

            if (user) {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ” ê²½ìš°
                const displayName = user.displayName;
                const uid = user.uid;

                // Firestoreì—ì„œ ì‚¬ìš©ì ë¬¸ì„œ ê°€ì ¸ì˜¤ê¸°
                const userDocRef = firebase.firestore().collection('user-id').doc(uid);

                userDocRef.get().then(function (doc) {
                    if (doc.exists) {
                        // ë¬¸ì„œê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° ì‚¬ìš©ìì˜ ì´ë¦„ ê°’ì„ ê°€ì ¸ì™€ì„œ UIì— í‘œì‹œ
                        const name = doc.data().name;
                        console.log("ì‚¬ìš©ì ì´ë¦„:", name);
                        // UI ì—…ë°ì´íŠ¸
                        userInfo.innerHTML = ''; // ë¶€ëª¨ ìš”ì†Œ ì´ˆê¸°í™”

                        // ì´ë¯¸ì§€ ì¶”ê°€
                        const image = document.createElement('img');
                        image.src = '/images/bluecheck.png';
                        image.alt = 'ë¡œê·¸ì¸ ì¤‘ ì´ë¯¸ì§€';
                        image.classList.add('user-image'); // í´ë˜ìŠ¤ ì¶”ê°€
                        userInfo.appendChild(image); // ì´ë¯¸ì§€ ì¶”ê°€

                        // ì´ë¦„ ì¶”ê°€
                        const userName = document.createElement('div');
                        userName.innerText = name;
                        userInfo.appendChild(userName); // ì´ë¦„ ì¶”ê°€

                    } else {
                        console.log("í•´ë‹¹ ì‚¬ìš©ìì˜ ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    }
                }).catch(function (error) {
                    console.log("ë¬¸ì„œë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì—ëŸ¬ ë°œìƒ:", error);
                });

            } else {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°
                userInfo.innerHTML = ''; // ë¶€ëª¨ ìš”ì†Œ ì´ˆê¸°í™”
            }
        });
    </script>

    <script>
        //ë¹„ì¦ˆë‹ˆìŠ¤ ê³„ì • ë¡œê·¸ì¸
        firebase.auth().onAuthStateChanged(function (user) {
            const userInfo = document.getElementById('userInfo');

            if (user) {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ” ê²½ìš°
                const displayName = user.displayName;
                const uid = user.uid;

                // Firestoreì—ì„œ ì‚¬ìš©ì ë¬¸ì„œ ê°€ì ¸ì˜¤ê¸°
                const userDocRef = firebase.firestore().collection('biz-id').doc(uid);

                userDocRef.get().then(function (doc) {
                    if (doc.exists) {
                        // ë¬¸ì„œê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° ì‚¬ìš©ìì˜ ì´ë¦„ ê°’ì„ ê°€ì ¸ì™€ì„œ UIì— í‘œì‹œ
                        const name = doc.data().name;
                        console.log("ì‚¬ìš©ì ì´ë¦„:", name);
                        // UI ì—…ë°ì´íŠ¸
                        userInfo.innerHTML = ''; // ë¶€ëª¨ ìš”ì†Œ ì´ˆê¸°í™”

                        // ì´ë¯¸ì§€ ì¶”ê°€
                        const image = document.createElement('img');
                        image.src = '/images/bizicon.png';
                        image.alt = 'ë¡œê·¸ì¸ ì¤‘ ì´ë¯¸ì§€';
                        image.classList.add('user-image'); // í´ë˜ìŠ¤ ì¶”ê°€
                        userInfo.appendChild(image); // ì´ë¯¸ì§€ ì¶”ê°€

                        image.style.marginRight = '5px'; // ì¢Œì¸¡ ë§ˆì§„ ì¡°ì •
                        image.style.marginTop = '3px'; // ì¢Œì¸¡ ë§ˆì§„ ì¡°ì •


                        // ìƒí˜¸ëª… ì¶”ê°€
                        const userName = document.createElement('div');
                        userName.innerText = name;
                        userInfo.appendChild(userName); // ìƒí˜¸ëª… ì¶”ê°€

                    } else {
                        console.log("í•´ë‹¹ ì‚¬ìš©ìì˜ ë¬¸ì„œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    }
                }).catch(function (error) {
                    console.log("ë¬¸ì„œë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì—ëŸ¬ ë°œìƒ:", error);
                });

            } else {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°
                userInfo.innerHTML = ''; // ë¶€ëª¨ ìš”ì†Œ ì´ˆê¸°í™”
            }
        });
    </script>

    <script>
        firebase.auth().onAuthStateChanged(function (user) {
            const loginButton = document.getElementById('loginButton');

            if (user) {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆëŠ” ê²½ìš°
                loginButton.innerText = 'ë¡œê·¸ì•„ì›ƒ';
                loginButton.addEventListener('click', function () {
                    firebase.auth().signOut().then(function () {
                        localStorage.clear(); // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ëœ userì— ëŒ€í•œ ì •ë³´ ì‚­ì œ ë¡œì§
                        console.log('ë¡œê·¸ì•„ì›ƒ ì„±ê³µ');
                    }).catch(function (error) {
                        console.log('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì—ëŸ¬ ë°œìƒ:', error);
                    });
                });
            } else {
                // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°
                loginButton.innerText = 'ë¡œê·¸ì¸';
                loginButton.addEventListener('click', function () {
                    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = '/login.html';
                });
            }
        });
    </script>

    <script>
        $(document).ready(function () {
            // ê²€ìƒ‰ì–´ ì œì¶œ ì‹œ
            $('#searchForm').submit(function (event) {
                event.preventDefault();
                var searchValue = $('#search').val(); // ê²€ìƒ‰ì–´

                window.location.href = 'searchResults.html?q=' + encodeURIComponent(searchValue);

                /*
                // 1. DB ì €ì¥ êµ¬í˜„
                db.collection("searchHistory").where("searchWord", "==", searchValue).get().then((ê²°ê³¼) => {
                    // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê²€ìƒ‰ì–´ì¼ ë•Œ
                    if (!ê²°ê³¼.empty) {
                        ê²°ê³¼.forEach((doc) => {
                            // ë¹ˆë„ìˆ˜ ì¦ê°€ ë° ê²€ìƒ‰ ì‹œê°„ ì—…ë°ì´íŠ¸
                            db.collection("searchHistory").doc(doc.id).update({
                                searchFrequency: firebase.firestore.FieldValue.increment(1),
                                searchTime: firebase.firestore.Timestamp.now()
                            });
                        });
                    } else {
                        // ìƒˆë¡œìš´ ê²€ìƒ‰ì–´ì¼ ë• DBì— ì¶”ê°€
                        db.collection("searchHistory").add({
                            searchWord: searchValue,
                            searchFrequency: 1,
                            searchTime: firebase.firestore.Timestamp.now()
                        });
                    }

                });
                */
            });

            // ì¸ê¸° ê²€ìƒ‰ì–´ ë¡œì§ êµ¬í˜„ í•¨ìˆ˜
            function getPopularSearchTerms() {
                db.collection("searchHistory")
                    .orderBy("searchTime", "desc") // ìµœê·¼ ê²€ìƒ‰ ì‹œê°„ ìˆœìœ¼ë¡œ
                    .orderBy("searchFrequency", "desc") // searchFrequency ìˆœìœ¼ë¡œ ì •ë ¬
                    .limit(8) // ìƒìœ„ 8ê°œë§Œ ì„ íƒ
                    .get()
                    .then((ê²°ê³¼) => {
                        var popularTerms = "";
                        ê²°ê³¼.forEach((doc) => {
                            var D = doc.data();
                            if (D.searchFrequency >= 5) {
                                popularTerms += `<div class="popularSearch_term">
                        <a class="content_popularSearch" href="/searchResults.html?q=${D.searchWord}">${D.searchWord}</a>
                        </div>`;
                            }

                        });
                        $(".keyword_wrap").append(popularTerms);
                    });
            }
            // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ê¸° ê²€ìƒ‰ì–´ í‘œì‹œ
            getPopularSearchTerms();
        });    
    </script>


    <div class="frame">
        <div class="header">
            <div class="header_wrap">
                <div class="header_content">
                    <img src="/images/5572662.png" style="width: 70px; padding-right: 10px;">
                    <h1 style="font-size: 27px; color: #f4511e;"><a href="/"
                            style="color: #f4511e; text-decoration: none;">ON</a></h1>
                </div>

                <div class="header_content">
                    <form id="searchForm" action="#">
                        <input class="search_input" id="search" name="q" type="text" placeholder="ì–´ë–¤ ìƒí’ˆì„ ì°¾ìœ¼ì‹œë‚˜ìš”?">
                        <button class="search_button" type="submit"><i
                                class="fa-solid fa-magnifying-glass"></i></button>
                    </form>
                </div>

                <div class="header_content">
                    <div id="userInfo" class="user-info"></div>
                    <a href="/myprofile.html" id="basketLink" >
                        <button style="cursor: pointer;" type="submit" class="basket_button"><i class="fa-solid fa-cart-shopping"></i></button>
                    </a>
                    <a href="/myprofile.html" id="profileLink">
                        <button type="submit" class="login_button"><i class="fa-solid fa-user"></i></button>
                    </a>
                    <button id="loginButton" class="logoutButton"></button>

                    <!-- ì±„íŒ…í•˜ê¸° ë²„íŠ¼ ì¶”ê°€ -->
                    <a href="chat.html" style="margin-left: 10px;">
                        <button id="chat_button" class="chat_button"
                            style="background-color: #4CAF50; color: white; border: none; padding: 10px 15px; text-align: center; text-decoration: none; display: inline-block; font-size: 1.0rem; margin: 4px 2px; cursor: pointer; border-radius: 5px;">
                            <i class="fa-solid fa-comment-dots" style="margin-right: 5px;"></i> ì±„íŒ…í•˜ê¸°
                        </button>
                    </a>
                </div>
            </div>
        </div>
        <script>
            $(document).ready(async function () {
                $('#basketLink').click(function (event) {
                    event.preventDefault();
                    firebase.auth().onAuthStateChanged((user) => {
                        if (!user) {
                            alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
                            window.location.href = "/login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
                        } else {
                            window.location.href = "/myprofile.html"; // ë¡œê·¸ì¸ì´ ë˜ì–´ ìˆë‹¤ë©´, myprofile.htmlë¡œ ì´ë™
                        }
                    });
                });
                $('#profileLink').click(function (event) {
                    event.preventDefault();
                    firebase.auth().onAuthStateChanged((user) => {
                        if (!user) {
                            alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
                            window.location.href = "/login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
                        } else {
                            window.location.href = "/myprofile.html"; // ë¡œê·¸ì¸ì´ ë˜ì–´ ìˆë‹¤ë©´, myprofile.htmlë¡œ ì´ë™
                        }
                    });
                });
            });

            $()

        </script>

        <nav class="navigator">

            <ul class="navigator_menu">
                <li><a href="/product.html">ì¤‘ê³ ê±°ë˜</a></li>
                <li><a href="/nearby.html">ë™ë„¤ìƒí™œ</a></li>
                <li><a href="/auction.html">ê²½ë§¤</a></li>
                <li><a href="/marketprice.html">ì‹œì„¸ì¡°íšŒ</a></li>
            </ul>
        </nav>

        <div class="body">
            <div class="body_content_box_1">
                <div class="body_content_1">
                    <div class="body_wrap">
                        <h2 class="big"><br>ë°˜ê°‘ìŠµë‹ˆë‹¤!</h2>
                        <p class="small">íŒë§¤í•˜ê³  ì‹¶ì€ ë¬¼ê±´ì´ ìˆìœ¼ì‹ ê°€ìš”?<br><br>ì§€ê¸ˆ ë°”ë¡œ ë¬¼ê±´ì„ ë“±ë¡í•´ë³´ì„¸ìš”.</p>
                        <br>
                        <a href="/upload.html">
                            <button type="submit" class="sell_button"><span>íŒë§¤í•˜ê¸°</span></button>
                        </a>
                    </div>
                    <div class="body_wrap">
                        <img class="image_1" src="https://ifh.cc/g/XZbKw9.jpg" width="650" height="auto">
                    </div>
                </div>
            </div>

            <div class="body_content_box_4">
                <div class="body_content_4">

                    <div class="body_wrap">
                        <img class="image_2" src="https://ifh.cc/g/3GVN7W.png" width="430" height="auto">
                    </div>

                    <div class="body_wrap">
                        <h2 class="big">ì¤‘ê³ ê±°ë˜,</h2>
                        <h2 class="big">ì´ì œ AIì™€ í•¨ê»˜í•˜ì„¸ìš”!</h2>
                        <p class="small">AI ì±—ë´‡ì€ 24ì‹œê°„ ìš´ì˜ë˜ì–´ ì—¬ëŸ¬ë¶„ê³¼ ìƒë‹´í•©ë‹ˆë‹¤.</p>

                        <br>
                        <a href="#">
                            <button type="submit" class="ai_button"><span>AI ì„œë¹„ìŠ¤ ë°”ë¡œê°€ê¸°</span></button>
                        </a>
                    </div>

                </div>
            </div>


            <div class="body_content_box_3" style="width: 1024px; margin: auto;">
                <h1 class="content_box_3_title" style="margin-left: 10px;">ë°©ê¸ˆ ë“±ë¡ëœ ìƒí’ˆ</h1>
            </div>

            <div class="more_item_wrap">
                <button class="more_item_btn1" style="cursor: pointer;">ìƒí’ˆ ë”ë³´ê¸°</button>
            </div>

            <div class="body_content_box_2">
                <div class="item_box">
                    <div class="item_box_1 mt-3">
                    </div>
                </div>

            </div>

            <div class="body_content_box_5" style="width: 1024px; margin: auto;">
                <h1 class="content_box_5_title" style="margin-left: 10px;">ì‹¤ì‹œê°„ ìƒí’ˆ</h1>
            </div>

            <div class="more_item_wrap">
                <button class="more_item_btn2" style="cursor: pointer;">ìƒí’ˆ ë”ë³´ê¸°</button>
            </div>

            <div class="body_content_box_6">
                <div class="item_box">
                    <div class="item_box_2">
                    </div>
                </div>
            </div>

        </div>

    </div>

    <div class="footer">

        <ul class="footer_icons">
            <li><a href="https://www.facebook.com/?locale=en_KR">
                    <i class="fa-brands fa-facebook"></i>
                </a></li>

            <li><a
                    href="https://www.instagram.com/sem/campaign/emailsignup/?campaign_id=13530338586&extra_1=s%7Cc%7C547419126431%7Ce%7Cinstagrame%7C&placement=&creative=547419126431&keyword=instagrame&partner_id=googlesem&extra_2=campaignid%3D13530338586%26adgroupid%3D126262418054%26matchtype%3De%26network%3Dg%26source%3Dnotmobile%26search_or_content%3Ds%26device%3Dc%26devicemodel%3D%26adposition%3D%26target%3D%26targetid%3Dkwd-299214942136%26loc_physical_ms%3D1009893%26loc_interest_ms%3D%26feeditemid%3D%26param1%3D%26param2%3D&gad_source=1&gclid=Cj0KCQjwzZmwBhD8ARIsAH4v1gUPvgu6tdqJm4fOsw0P0rsYncgBNaGc7qM6__SJUu5tKHzwm5yOkwMaAmBCEALw_wcB">
                    <i class="fa-brands fa-instagram"></i>
                </a></li>

            <li><a href="#">
                    <i class="fa-brands fa-youtube"></i>
                </a></li>

            <li><a href="#">
                    <i class="fa-brands fa-twitter"></i>
                </a></li>
        </ul>

        <div class="footer_wrap">
            <button class="footer_title">ìµœê·¼ ì¸ê¸°ê²€ìƒ‰ì–´</button>
        </div>

        <div class="keyword_wrap">
        </div>
    </div>


    <button class="chatbot-toggler">
        <span class="material-symbols-rounded">mode_comment</span>
        <span class="material-symbols-outlined">close</span>
    </button>

    <div class="chatbot">
        <header>
            <h2>ON Market Chatbot</h2>
            <span class="close-btn material-symbols-outlined">close</span>
        </header>
        <ul class="chatbox">
            <li class="chat incoming">
                <span class="material-symbols-outlined">smart_toy</span>
                <p>ì•ˆë…•í•˜ì„¸ìš” ON Market ì±—ë´‡ì…ë‹ˆë‹¤ğŸ‘‹<br>ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</p>
            </li>


            <!-- API í˜¸ì¶œì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•œ ì˜ˆìƒì§ˆë¬¸ ì¶”ê°€ -->
            <li class="chat incoming">
                <span class="material-symbols-outlined">smart_toy</span>
                <div class="suggestions">
                    <ul>
                        <div
                            style="background-color: #f9f9f9; border: 2px solid #e0e0e0; border-radius: 10px; padding: 10px; max-width: 600px; margin: auto;">
                            <p style="text-align: center; font-size: 1.2em; font-weight: bold; color: #333;">â“ ìì£¼ í•˜ëŠ” ì§ˆë¬¸ë“¤ â“</p>
                            <ul style="list-style-type: none; padding: 0;">
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">ğŸ¤” ì¤‘ê³  ê±°ë˜í•  ë•Œ ë¬´ì¡°ê±´ ë„¤ê³ ë¥¼ í•´ì•¼ í• ê¹Œìš”?</li>
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">ğŸ” ì¤‘ê³  ê±°ë˜ì—ì„œ ì–´ë–¤ í’ˆëª©ì´ ì¸ê¸°ê°€ ê°€ì¥ ë§ì€ê°€ìš”?</li>
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">ğŸ“¦ ì§ê±°ë˜ ë§ê³  íƒë°° ê±°ë˜ë¥¼ í•´ë„ ê´œì°®ì„ê¹Œìš”?</li>
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">ğŸ”„ ê±°ë˜ í›„ ë°˜í’ˆì´ ê°€ëŠ¥í•œê°€ìš”?</li>
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">â­ ì¤‘ê³  ê±°ë˜ í”Œë«í¼ ì¤‘ ì–´ëŠ ê³³ì´ ê°€ì¥ ì‹ ë¢°í•  ë§Œí•œê°€ìš”?</li>
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">ğŸ’¼ ì¤‘ê³  ê±°ë˜ì‹œ ì„¸ê¸ˆ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‚˜ìš”?</li>
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">ğŸ’° ì¤‘ê³  ê±°ë˜ì—ì„œ ê°€ê²©ì„ ì–´ë–»ê²Œ ì±…ì •í•˜ë‚˜ìš”?</li>
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">ğŸš¨ ì•ˆì „í•œ ê±°ë˜ë¥¼ ìœ„í•´ ì–´ë–¤ ì ì„ ì£¼ì˜í•´ì•¼ í•˜ë‚˜ìš”?</li>
                                <li class="suggestion" style="margin-bottom: 5px; font-size: 1em; color: #555;">âš ï¸ ì¤‘ê³  ê±°ë˜ì‚¬ê¸°ë¥¼ ë‹¹í–ˆëŠ”ë° ì–´ë–»ê²Œ ëŒ€ì²˜í•´ì•¼ í• ê¹Œìš”?</li>
                            </ul>
                        </div>
                    </ul>
                </div>
            </li>
        </ul>
        <div class="chat-input">
            <textarea id="user-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”..." spellcheck="false" required></textarea>
            <span id="send-btn" class="material-symbols-rounded">send</span>
        </div>
    </div>

    <script src="apikey.js"></script>
    <script>
        const chatbotToggler = document.querySelector(".chatbot-toggler");
        const closeBtn = document.querySelector(".close-btn");
        const chatbox = document.querySelector(".chatbox");
        const chatInput = document.querySelector(".chat-input textarea");
        const sendChatBtn = document.querySelector(".chat-input span");

        let conversationHistory = [];
        let cachedQuestion = null;
        let cachedResponse = null;

        const API_KEY = "OPENAI_API_KEY";
        const inputInitHeight = chatInput.scrollHeight;

        const createChatLi = (message, className) => {
            const chatLi = document.createElement("li");
            chatLi.classList.add("chat", `${className}`);
            let chatContent = className === "outgoing" ? `<p></p>` : `<span class="material-symbols-outlined">smart_toy</span><p></p>`;
            chatLi.innerHTML = chatContent;
            chatLi.querySelector("p").textContent = message;
            return chatLi;
        }

        const generateResponse = (chatElement) => {
            const messageElement = chatElement.querySelector("p");

            if (cachedQuestion && conversationHistory.length > 0 && conversationHistory[conversationHistory.length - 1].content === cachedQuestion) {
                messageElement.textContent = cachedResponse;
                chatbox.scrollTo(0, chatbox.scrollHeight);
                return;
            }

            const API_URL = "https://api.openai.com/v1/chat/completions";
            const requestOptions = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${API_KEY}`
                },
                body: JSON.stringify({
                    model: "gpt-3.5-turbo",
                    messages: conversationHistory
                })
            };

            fetch(API_URL, requestOptions)
                .then(res => res.json())
                .then(data => {
                    const response = data.choices[0].message.content.trim();
                    messageElement.textContent = response;

                    cachedQuestion = conversationHistory[conversationHistory.length - 1].content;
                    cachedResponse = response;

                    conversationHistory.push({ role: "assistant", content: response });
                })
                .catch(() => {
                    messageElement.classList.add("error");
                    messageElement.textContent = "ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.";
                })
                .finally(() => chatbox.scrollTo(0, chatbox.scrollHeight));
        }

        const handleChat = (userMessage) => {
            if (!userMessage) return;

            chatInput.value = "";
            chatInput.style.height = `${inputInitHeight}px`;

            chatbox.appendChild(createChatLi(userMessage, "outgoing"));
            chatbox.scrollTo(0, chatbox.scrollHeight);

            conversationHistory.push({ role: "user", content: userMessage });

            setTimeout(() => {
                const incomingChatLi = createChatLi("ì±—ë´‡ì´ ë‹µë³€ ì¤‘ì…ë‹ˆë‹¤...", "incoming");
                chatbox.appendChild(incomingChatLi);
                chatbox.scrollTo(0, chatbox.scrollHeight);
                generateResponse(incomingChatLi);
            }, 600);
        }

        chatInput.addEventListener("input", () => {
            chatInput.style.height = `${inputInitHeight}px`;
            chatInput.style.height = `${chatInput.scrollHeight}px`;
        });

        chatInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) {
                e.preventDefault();
                handleChat(chatInput.value.trim());
            }
        });

        sendChatBtn.addEventListener("click", () => handleChat(chatInput.value.trim()));
        closeBtn.addEventListener("click", () => document.body.classList.remove("show-chatbot"));
        chatbotToggler.addEventListener("click", () => document.body.classList.toggle("show-chatbot"));

        document.querySelectorAll(".suggestion").forEach(suggestion => {
            suggestion.addEventListener("click", (e) => {
                const question = e.target.textContent;
                const responses = {
                    "ğŸ¤” ì¤‘ê³  ê±°ë˜í•  ë•Œ ë¬´ì¡°ê±´ ë„¤ê³ ë¥¼ í•´ì•¼ í• ê¹Œìš”?": "ì¤‘ê³  ê±°ë˜ì—ì„œ ë„¤ê³ ëŠ” ì„ íƒ ì‚¬í•­ì´ì—ìš”. íŒë§¤ìê°€ ì œì‹œí•œ ê°€ê²©ì´ ë§ˆìŒì— ë“¤ë©´ ê·¸ëŒ€ë¡œ êµ¬ë§¤í•˜ì…”ë„ ë˜ê³ , ê°€ê²©ì´ ì¡°ê¸ˆ ë¶€ë‹´ìŠ¤ëŸ¬ìš°ì‹œë©´ ì˜ˆì˜ ë°”ë¥´ê²Œ ë„¤ê³ ë¥¼ ìš”ì²­í•´ë³´ì…”ë„ ë©ë‹ˆë‹¤. ì„œë¡œ ì¡´ì¤‘í•˜ëŠ” íƒœë„ë¡œ ëŒ€í™”í•˜ë©´ ì¢‹ì€ ê±°ë˜ë¥¼ í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”.",
                    "ğŸ” ì¤‘ê³  ê±°ë˜ì—ì„œ ì–´ë–¤ í’ˆëª©ì´ ì¸ê¸°ê°€ ê°€ì¥ ë§ì€ê°€ìš”?": "ì¤‘ê³  ê±°ë˜ì—ì„œëŠ” ì „ìê¸°ê¸°, íŠ¹íˆ ìŠ¤ë§ˆíŠ¸í°, ë…¸íŠ¸ë¶, íƒœë¸”ë¦¿ ë“±ì´ ë§¤ìš° ì¸ê¸°ê°€ ë§ì•„ìš”. ê·¸ ì™¸ì—ë„ ì˜ë¥˜, ê°€ì „ì œí’ˆ, ê°€êµ¬, ì•„ì›ƒë„ì–´ ìš©í’ˆ ë“±ë„ ë§ì€ ì‚¬ëŒë“¤ì´ ì°¾ëŠ” í’ˆëª©ì´ëë‹ˆë‹¤. íŠ¸ë Œë“œì— ë”°ë¼ ì¸ê¸°ê°€ ìˆëŠ” í’ˆëª©ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ì°¸ê³ í•˜ì„¸ìš”.",
                    "ğŸ“¦ ì§ê±°ë˜ ë§ê³  íƒë°° ê±°ë˜ë¥¼ í•´ë„ ê´œì°®ì„ê¹Œìš”?": "ë„¤, íƒë°° ê±°ë˜ë„ ì¶©ë¶„íˆ ì•ˆì „í•˜ê²Œ í•  ìˆ˜ ìˆì–´ìš”. ë‹¤ë§Œ, ê±°ë˜ ì „ì— íŒë§¤ìì™€ íƒë°°ë¹„ì™€ ë°°ì†¡ ë°©ë²• ë“±ì„ ë¯¸ë¦¬ í˜‘ì˜í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”. ë˜í•œ, ê±°ë˜ ë‚´ì—­ì„ ë‚¨ê¸°ê³ , ì•ˆì „í•œ ê²°ì œ ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.",
                    "ğŸ”„ ê±°ë˜ í›„ ë°˜í’ˆì´ ê°€ëŠ¥í•œê°€ìš”?": "ì¤‘ê³  ê±°ë˜ì—ì„œëŠ” ë³´í†µ ë°˜í’ˆì´ ì–´ë µì§€ë§Œ, íŒë§¤ìì™€ ë¯¸ë¦¬ í˜‘ì˜í•˜ì—¬ ë°˜í’ˆ ì¡°ê±´ì„ ì •í•´ë‘ëŠ” ê²ƒì´ ì¢‹ì•„ìš”. ì œí’ˆ ìƒíƒœì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ê³¼ ì‚¬ì§„ì„ ì˜ í™•ì¸í•˜ê³ , í•„ìš”ì‹œ ì¶”ê°€ ì§ˆë¬¸ì„ í†µí•´ í™•ì‹¤íˆ í™•ì¸í•œ í›„ ê±°ë˜ë¥¼ ì§„í–‰í•˜ëŠ” ê²ƒì´ ì•ˆì „í•©ë‹ˆë‹¤.",
                    "â­ ì¤‘ê³  ê±°ë˜ í”Œë«í¼ ì¤‘ ì–´ëŠ ê³³ì´ ê°€ì¥ ì‹ ë¢°í•  ë§Œí•œê°€ìš”?": "í˜„ì¬ ìš°ë¦¬ë‚˜ë¼ ì¤‘ê³  ê±°ë˜ í”Œë«í¼ìœ¼ë¡œëŠ” ë‹¹ê·¼ë§ˆì¼“, ë²ˆê°œì¥í„°, ì¤‘ê³ ë‚˜ë¼ ë“±ì´ ë§ì´ ì‚¬ìš©ë˜ê³  ìˆì–´ìš”. í•˜ì§€ë§Œ ì €í¬ ON Marketë„ ì‹ ë¢°í•˜ê³  ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆë„ë¡ ìµœì„ ì„ ë‹¤í•˜ê³  ìˆìœ¼ë‹ˆ ë§ì€ ì´ìš© ë¶€íƒë“œë ¤ìš”ğŸ˜ŠğŸ˜Š",
                    "ğŸ’¼ ì¤‘ê³  ê±°ë˜ ì‹œ ì„¸ê¸ˆ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆë‚˜ìš”?": "ê°œì¸ ê°„ì˜ ì†Œê·œëª¨ ì¤‘ê³  ê±°ë˜ì—ì„œëŠ” ì¼ë°˜ì ìœ¼ë¡œ ì„¸ê¸ˆ ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šì•„ìš”. í•˜ì§€ë§Œ, ê±°ë˜ ê¸ˆì•¡ì´ í¬ê±°ë‚˜, ì‚¬ì—…ì ìœ¼ë¡œ ì¤‘ê³ í’ˆì„ íŒë§¤í•˜ëŠ” ê²½ìš°ì—ëŠ” ì„¸ê¸ˆ ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë‹ˆ, í•„ìš”í•œ ê²½ìš° ì „ë¬¸ê°€ì™€ ìƒë‹´í•´ë³´ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.",
                    "ğŸ’° ì¤‘ê³  ê±°ë˜ì—ì„œ ê°€ê²©ì„ ì–´ë–»ê²Œ ì±…ì •í•˜ë‚˜ìš”?": "ì¤‘ê³  ê±°ë˜ ê°€ê²©ì€ ì œí’ˆì˜ ìƒíƒœ, ì›ë˜ ê°€ê²©, ì‚¬ìš© ê¸°ê°„, ì‹œì¥ ìˆ˜ìš” ë“±ì„ ê³ ë ¤í•´ì„œ ì±…ì •í•´ìš”. ë¹„ìŠ·í•œ ì œí’ˆì˜ ê±°ë˜ ê°€ê²©ì„ ì°¸ê³ í•˜ê³ , ìƒíƒœì— ë”°ë¼ ì ì ˆí•œ ê°€ê²©ì„ ì •í•˜ë©´ ë¼ìš”. í•©ë¦¬ì ì¸ ê°€ê²©ì„ ì œì‹œí•˜ë©´ ì›í™œí•œ ê±°ë˜ê°€ ì´ë£¨ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.",
                    "ğŸš¨ ì•ˆì „í•œ ê±°ë˜ë¥¼ ìœ„í•´ ì–´ë–¤ ì ì„ ì£¼ì˜í•´ì•¼ í•˜ë‚˜ìš”?": "ì•ˆì „í•œ ê±°ë˜ë¥¼ ìœ„í•´ì„œëŠ” ë¨¼ì € íŒë§¤ìë‚˜ êµ¬ë§¤ìì˜ ì‹ ë¢°ë„ë¥¼ í™•ì¸í•˜ì„¸ìš”. ì§ê±°ë˜ ì‹œì—ëŠ” ì‚¬ëŒì´ ë§ì€ ê³µê³µì¥ì†Œì—ì„œ ë§Œë‚˜ëŠ” ê²ƒì´ ì¢‹ê³ , íƒë°° ê±°ë˜ ì‹œì—ëŠ” ì•ˆì „ê²°ì œ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. ë˜í•œ, ê±°ë˜ ë‚´ì—­ì„ ê¼­ ê¸°ë¡í•´ë‘ì„¸ìš”.",
                    "âš ï¸ ì¤‘ê³  ê±°ë˜ ì‚¬ê¸°ë¥¼ ë‹¹í–ˆëŠ”ë° ì–´ë–»ê²Œ ëŒ€ì²˜í•´ì•¼ í• ê¹Œìš”?": "ì¤‘ê³  ê±°ë˜ ì‚¬ê¸°ë¥¼ ë‹¹í–ˆë‹¤ë©´ ì¦‰ì‹œ ê±°ë˜í•œ í”Œë«í¼ì˜ ê³ ê°ì„¼í„°ì— ì‹ ê³ í•˜ê³ , ê²½ì°°ì— ê³ ì†Œì¥ì„ ì œì¶œí•˜ì„¸ìš”. ê°€ëŠ¥í•œ ëª¨ë“  ì¦ê±° ìë£Œë¥¼ ëª¨ì•„ë‘ëŠ” ê²ƒì´ ì¤‘ìš”í•´ìš”. ê±°ë˜ ë‚´ì—­, ëŒ€í™” ë‚´ìš©, ì†¡ê¸ˆ ë‚´ì—­ ë“±ì„ ê¼¼ê¼¼íˆ ê¸°ë¡í•´ë‘ì‹œë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤."
                };

                chatbox.appendChild(createChatLi(question, "outgoing"));
                chatbox.appendChild(createChatLi(responses[question], "incoming"));
                chatbox.scrollTo(0, chatbox.scrollHeight);
            });
        });




        document.querySelector('.ai_button').addEventListener('click', function (event) {
            document.body.classList.toggle('show-chatbot');
        });



        // ìƒë‹¨ ì±„íŒ…í•˜ê¸° ë²„íŠ¼ì— ëŒ€í•œ ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                localStorage.setItem('user', JSON.stringify(user))
            }
        })

        var ë‚´uid = JSON.parse(localStorage.getItem('user')).uid


        $(document).ready(function () {
            $('#chat_button').click(function (event) {
                event.preventDefault();
                firebase.auth().onAuthStateChanged((user) => {
                    if (user) {
                        // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë˜ì–´ ìˆì„ ë•Œ
                        window.location.href = "/chat.html";
                    } else {
                        // ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ë˜ì–´ ìˆì§€ ì•Šì„ ë•Œ
                        alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
                        window.location.href = "/login.html";
                    }
                });
            });
        });


    </script>

    <script>
        $(document).ready(async function () {
            $('#chat_button').click(function (event) {
                event.preventDefault();
                firebase.auth().onAuthStateChanged((user) => {
                    if (!user) {
                        alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
                        window.location.href = "/login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰ì…˜
                    } else {
                    }
                });
            });
        });
    </script>


    <style>
        /* ì¶”ê°€ëœ CSS ì½”ë“œ */
        .suggestions {
            margin-top: 10px;
        }

        .suggestions p {
            font-weight: bold;
            margin-bottom: 5px;
            text-align: center;
            font-size: 1.5em;
        }

        .suggestions ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .suggestions .suggestion {
            background: #e0e0e0;
            color: #000;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .suggestions .suggestion:hover {
            background: #bdbdbd;
        }
    </style>
</body>

</html>