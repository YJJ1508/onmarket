<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/e1a2c43e41.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="/images/5572662.png" type="/images/5572662.png">
    
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" 
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous">
    </script>
    <script>
        const firebaseConfig = {
            apiKey: "FIREBASE_API_KEY",
            authDomain: "FIREBASE_AUTH_DOMAIN",
            projectId: "FIREBASE_PROJECT_ID",
            storageBucket: "FIREBASE_STORAGE_BUCKET",
            messagingSenderId: "FIREBASE_MESSAGING_SENDER_ID",
            appId: "FIREBASE_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>
    <title>ON-MARKET</title>
    <link rel="stylesheet" href="../css/order.css">
</head>
<body>
    <div class="header" style="margin: 15px;">
        <div class="header_wrap">
            <div class="header_content">
                <img src="/images/5572662.png" style="width: 80px; margin-top: 8px; padding-right: 10px;">
                <h1 style="margin-top: 19px; font-size: 27px; color: #f4511e; font-weight: bold;"><a href="/" style="color: #f4511e; text-decoration: none;">ON</a></h1>
            </div>
            <div class="header_content">
                <div id="userInfo" class="user-info"></div>
                <a href="/myprofile.html">
                    <button type="submit" class="basket_button"><i class="fa-solid fa-cart-shopping"></i></button>
                </a>
                <a href="/myprofile.html">
                    <button type="submit" class="login_button"><i class="fa-solid fa-user"></i></button>
                </a>
                
            </div>
        </div> 
    </div>
    <div class="body" style="width: 1024px; margin: auto;">
        <div class="body_title" style="padding-left: 90px;">
            <h2>주문목록</h2>
        </div>
        <div class="body_content" id="body_content">
           
        </div>
    </div>

    <!--USER정보 확인 후 내 결제 내역 가져오기-->
    <script>
        $(document).ready(function() {
            firebase.auth().onAuthStateChanged((user) => {
            if (!user) {
                alert("로그인 후 이용해주세요")
                window.location.href = "/login.html";
            } 
            });
        });

        var 내uid = JSON.parse(localStorage.getItem('user')).uid 
        
        console.log("내 uid", 내uid)
        // 거래한 상품 정보 및 결제 정보

        db.collection("order").where("구매자_id", "==", 내uid).get().then((result) => {
            var 템플릿 = "";

            var hasorder = false;
            result.forEach((doc) => {
                hasorder = true;
                var 링크 = (doc.data().타입 ==="auction") ? `/detail_auction.html?id=${doc.data().상품_id}` : `/detail.html?id=${doc.data().상품_id}`
                var 표시 = (doc.data().타입 ==="auction") ? `/images/bid (1).png`: `/images/shopping-bag.png`;
                var 타입 = (doc.data().타입 ==="auction") ? `경매상품` : `중고상품`;

                console.log(doc.id, doc.data());
                템플릿 += 
                    `<div class="show_order" id="orders">
                        <a href=${링크}>
                            <img src="${doc.data().이미지1}" style="width: 100px; height: 100px; border-radius: 10px; padding-left: 5px;">
                        </a>    
                        <div class="order_details1">
                            <p>판매자: ${doc.data().판매자}</p>
                            <p>상품명: ${doc.data().상품명}</p>
                            <p>상품타입: ${타입}</p>
                        </div>
                        <div class="order_details2">
                            <p>구매자: ${doc.data().구매자}</p>
                            <p>상품금액: ${doc.data().가격}원</p>
                            <p>주문상태: ${doc.data().주문상태}</p>
                        </div>
                        <div class="state">
                            <img src="${표시}" style="width: 70px; height: 70px;">
                        </div>
                    </div>`
            });
            if(hasorder == false){
                var text = `<div style="text-align: center; margin-top: 100px; font-size: 30px;">주문 상품이 없습니다.</div>`
                $('.body_content').append(text);
            }
            $('.body_content').append(템플릿);
        })
    </script>



</body>
</html>