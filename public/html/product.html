<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/e1a2c43e41.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" href="/images/5572662.png" type="/images/5572662.png">
    <title>ON-MARKET</title>
    <link rel="stylesheet" href="../css/product.css">
</head>

<body>
    <!-- Firebase and jQuery scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Firebase configuration -->
    <script>
        const firebaseConfig = {
            apiKey: "FIREBASE_API_KEY",
            authDomain: "FIREBASE_AUTH_DOMAIN",
            projectId: "FIREBASE_PROJECT_ID",
            storageBucket: "FIREBASE_STORAGE_BUCKET",
            messagingSenderId: "FIREBASE_MESSAGING_SENDER_ID",
            appId: "FIREBASE_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        $(document).ready(function () {
            function fetchProducts() {
                db.collection('product').orderBy('날짜', 'desc').get()
                    .then((snapshot) => {
                        snapshot.forEach((doc) => {
                            let formattedPrice = Number(doc.data().가격).toLocaleString();
                            let priceInfo = doc.data().무료나눔 ? '무료 나눔' : `${formattedPrice}원`;

                            var 템플릿 = `
                    <div class="item">
                        <a href="/detail.html?id=${doc.id}" class="item_link" data-id="${doc.id}">
                            <img class="item_image" src="${doc.data().이미지1}" style="border-radius: 12px;">
                            <h2 class="item_name">${doc.data().제목}</h2>
                            <h2 class="item_cost" style="font-size: 30px;">${priceInfo}</h2>
                            <h1 class="item_place">${doc.data().주소}</h1>
                            <div class="like_chating">
                                <span class="like">조회수 ${doc.data().조회수}</span>
                                <span>&nbsp;&nbsp;・&nbsp;&nbsp;</span>
                                <span class="chat">채팅 ${doc.data().채팅데이터}</span>
                                <span>&nbsp;&nbsp;・&nbsp;&nbsp;</span>
                                <span class="chat">관심 ${doc.data().관심}</span>
                            </div>
                        </a>
                    </div>`;

                            $('.item_box_1').append(템플릿); // 상품 추가
                        });

                        arrangeGrid();

                        // 모든 아이템에 직접 CSS를 설정하여 너비를 고정
                        $('.item_box_1 .item').css('width', 'calc(25% - 20px)');
                    })
                    .catch((error) => {
                        console.log("Error getting documents: ", error);
                    });
            }

            fetchProducts();

            function arrangeGrid() {
                const displayedItems = $('.item_box_1 .item').length;
                const rowCount = Math.ceil(displayedItems / 4);
                $('.item_box_1').css('grid-template-rows', `repeat(${rowCount}, auto)`);

                if (displayedItems >= 4) {
                    $('.item_box_1 .item').css('display', 'block');
                    $('.item_box_1 .item').css('float', 'left');
                }
            }
        });

    </script>

    <script>
        $(document).ready(async function () {
            $('#basketLink').click(function (event) {
                event.preventDefault();
                firebase.auth().onAuthStateChanged((user) => {
                    if (!user) {
                        alert("로그인 후 이용해주세요.");
                        window.location.href = "/login.html"; // 로그인 페이지로 리다이렉션
                    } else {
                        window.location.href = "/myprofile.html"; // 로그인이 되어 있다면, myprofile.html로 이동
                    }
                });
            });
            $('#profileLink').click(function (event) {
                event.preventDefault();
                firebase.auth().onAuthStateChanged((user) => {
                    if (!user) {
                        alert("로그인 후 이용해주세요.");
                        window.location.href = "/login.html"; // 로그인 페이지로 리다이렉션
                    } else {
                        window.location.href = "/myprofile.html"; // 로그인이 되어 있다면, myprofile.html로 이동
                    }
                });
            });
        });
    </script>

    <!-- Header -->
    <div class="header" style="margin-right: 15px;">
        <div class="header_wrap">
            <div class="header_content">
                <img src="/images/5572662.png" style="width: 80px; margin-top: 8px; padding-right: 10px;">
                <h1 style="margin-top: 19px; font-size: 27px; color: #f4511e; font-weight: bold;"><a href="/"
                        style="color: #f4511e; text-decoration: none;">ON</a></h1>
            </div>

            <div class="header_content">
                <a href="/myprofile.html">
                    <button type="submit" id="basketLink" class="basket_button"><i
                            class="fa-solid fa-cart-shopping"></i></button>
                </a>

                <a href="/myprofile.html">
                    <button type="submit" id="profileLink" class="login_button"><i
                            class="fa-solid fa-user"></i></button>
                </a>
            </div>
        </div>
    </div>

    <div class="background-wall">
        <div class="bw-contents">
            <h2>이웃과 함께하는 <br>안심 중고 거래</h2>
            <p>동네 주민들과의 따뜻한 거래를 지금 경험해보세요.</p>
        </div>
    </div>

    <div class="body_content_box_3" style="width: 1024px; margin: auto;">
        <h1 class="content_box_3_title" style="margin-left: 10px;">방금 등록된 상품</h1>
    </div>

    <div class="body_content_box_2">
        <div class="item_box">
            <div class="item_box_1 mt-3">
            </div>
        </div>

    </div>
</body>

</html>